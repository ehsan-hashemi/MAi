<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAi - Chat GPT</title>
    <link rel="icon" type="image/png" href="MAI.png">
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
pre {
  position: relative;
  background: #f6f8fa;
  padding: 1em;
  border-radius: 10px;
  overflow: auto;
  direction: ltr;
}
.copy-icon {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 24px;
  height: 24px;
  background-image: url('https://dbkhatam.ir/jss/content_copy_24dp_000000_FILL0_wght400_GRAD0_opsz24.png');
  background-size: contain;
  background-repeat: no-repeat;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}
.copy-icon:hover {
  opacity: 1;
}
</style>
</head>
<body>
    <div class="navbar0"></div>
    <div class="navbar1">MAi - Chat GPT</div>
    <div class="navbar2">Ehsan Group</div>
    <!-- <p class="abtph">توجه: ChatM از هوش مصنوعی استفاده نمی‌کند و ممکن است پیام های شما را درک نکند! <a href="/about_ghatbotghatm/">برای جزئیات بیشتر وارد شوید.</a></p> -->
    <div class="chat-container">
        <div id="chat-box"></div>
        <div class="input-container">
            <textarea id="user-input" placeholder="پیام خود را بنویسید..."></textarea>
            <button class="send-button" onclick="sendMessage()">
                <i class="arrow-up"></i>
            </button>
        </div>
    </div>
    <p style="text-align: center;">همچنین می‌توانید از چت بات ادبیات ما نیز دیدن کنید: @chatbot_abc</p>
    <p style="text-align: center;">با هوش مصنوعی Gemini هم صحبت کنید: @Gemini</p>

    <script>
    async function sendMessage() {
        const userInputElement = document.getElementById("user-input");
        const userInput = userInputElement.value.trim();
        if (!userInput) return;

        appendMessage("user", userInput);
        userInputElement.value = "";

        const apiUrl = 'https://ai.liara.ir/api/v1/6846f3cbf1adf322202df4f1/chat/completions';
        const apiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2ODE0OGQ5NDUwOTYzZjkzNDg4OTM1Y2UiLCJ0eXBlIjoiYXV0aCIsImlhdCI6MTc0OTU1MDA4NH0.yEhFnrwpT10ZIMfPmZV1Y5dXCa34pC52WX9iXOfplz0';

        const requestData = {
            model: 'openai/gpt-4o-mini',
            messages: [
                {
                    role: 'user',
                    content: userInput
                }
            ]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            const aiResponse = data.choices[0].message.content;

            appendMessage("bot", aiResponse);
        } catch (error) {
            console.error('Error:', error);
            appendMessage("bot", 'خطا در دریافت پاسخ: ' + error.message);
        }
    }

    function appendMessage(sender, message) {
  const chatBox = document.getElementById("chat-box");
  const messageElem = document.createElement("div");

  if (sender === "user") {
    messageElem.className = "message user-message";
    messageElem.innerText = message;
  } else {
    messageElem.className = "message bot-message";
    messageElem.innerHTML = marked.parse(message);

    // پیدا کردن بلوک‌های کد و افزودن دکمه کپی
    messageElem.querySelectorAll("pre").forEach(pre => {
      const copyBtn = document.createElement("div");
      copyBtn.className = "copy-icon";
      copyBtn.title = "کپی کردن کد";

      copyBtn.onclick = () => {
        const codeText = pre.innerText;
        navigator.clipboard.writeText(codeText).then(() => {
          copyBtn.style.opacity = "1";
          copyBtn.style.filter = "grayscale(100%)";
          setTimeout(() => {
            copyBtn.style.filter = "none";
            copyBtn.style.opacity = "0.7";
          }, 1500);
        });
      };

      pre.appendChild(copyBtn);
    });
  }

  chatBox.appendChild(messageElem);
  chatBox.scrollTop = chatBox.scrollHeight;
}

</script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript"></script>

    <script>
        // اضافه کردن رویداد برای کلیدهای Enter و Shift+Enter
        $('#user-input').keydown(function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                $('.send-button').click();
            } else if (e.key === "Enter" && e.shiftKey) {
                return true;
            }
        });

    </script>    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // انتخاب تمام متن‌های صفحه
            document.body.innerHTML = document.body.innerHTML.replace(/@(\w+)/g, '<a href="/$1">@$1</a>');
        });
    </script>
</body>
</html>
